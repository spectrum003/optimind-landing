<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Optimind - Bienestar Estudiantil</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #8E2DE2 0%, #4A00E0 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: 
                radial-gradient(circle at 30% 30%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 20% 80%, rgba(119, 198, 255, 0.2) 0%, transparent 50%);
            animation: float 20s infinite linear;
            z-index: -2;
        }

        @keyframes float {
            0% { transform: translate(0, 0) rotate(0deg); }
            100% { transform: translate(-50px, -50px) rotate(360deg); }
        }

        .iphone-glass {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(40px) saturate(180%);
            -webkit-backdrop-filter: blur(40px) saturate(180%);
            border-radius: 32px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 
                0 32px 64px rgba(0, 0, 0, 0.25),
                0 8px 16px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.4),
                inset 0 -1px 0 rgba(0, 0, 0, 0.1);
            padding: 48px 36px;
            max-width: 420px;
            width: 100%;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .iphone-glass::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, 
                rgba(255, 255, 255, 0.1) 0%,
                rgba(255, 255, 255, 0.05) 50%,
                rgba(255, 255, 255, 0.1) 100%);
            z-index: -1;
        }

        .glass-shine {
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, 
                transparent 30%, 
                rgba(255, 255, 255, 0.1) 50%, 
                transparent 70%);
            animation: shine 8s infinite linear;
            z-index: -1;
        }

        @keyframes shine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .logo {
            font-size: 2.8rem;
            font-weight: 800;
            background: linear-gradient(135deg, #FFFFFF, rgba(255, 255, 255, 0.8));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 12px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .tagline {
            color: rgba(255, 255, 255, 0.8);
            font-size: 1.1rem;
            margin-bottom: 48px;
            font-weight: 500;
            letter-spacing: -0.2px;
        }

        .step {
            display: none;
            animation: slideUp 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .step.active {
            display: block;
        }

        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(40px) scale(0.96);
            }
            to { 
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        h1 {
            color: rgba(255, 255, 255, 0.95);
            font-size: 1.9rem;
            margin-bottom: 20px;
            font-weight: 700;
            letter-spacing: -0.5px;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .subtitle {
            color: rgba(255, 255, 255, 0.75);
            font-size: 1.05rem;
            margin-bottom: 40px;
            line-height: 1.5;
            font-weight: 400;
        }

        .emoji-grid {
            display: grid;
            gap: 16px;
            margin: 40px 0;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 24px;
            padding: 28px 24px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            display: flex;
            align-items: center;
            gap: 20px;
            text-align: left;
            position: relative;
            overflow: hidden;
        }

        .glass-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.1), 
                transparent);
            transition: left 0.6s ease;
        }

        .glass-card:hover::before {
            left: 100%;
        }

        .glass-card:hover {
            transform: translateY(-6px) scale(1.02);
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.3),
                0 8px 16px rgba(0, 0, 0, 0.2);
        }

        .glass-card.verde { color: rgba(72, 187, 120, 0.9); }
        .glass-card.amarillo { color: rgba(245, 158, 11, 0.9); }
        .glass-card.rojo { color: rgba(239, 68, 68, 0.9); }

        .emoji-icon {
            font-size: 2.4rem;
            flex-shrink: 0;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.2));
        }

        .emoji-text {
            flex: 1;
        }

        .emoji-title {
            font-weight: 600;
            margin-bottom: 6px;
            font-size: 1.15rem;
            letter-spacing: -0.3px;
        }

        .emoji-desc {
            font-size: 0.92rem;
            opacity: 0.9;
            line-height: 1.4;
            color: rgba(255, 255, 255, 0.8);
        }

        .glass-select {
            width: 100%;
            padding: 16px 18px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 18px;
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            color: rgba(255, 255, 255, 0.9);
            margin: 16px 0;
            transition: all 0.3s ease;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='rgba(255,255,255,0.7)' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 16px center;
            background-size: 20px;
        }

        .glass-input {
            width: 100%;
            padding: 16px 18px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 18px;
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            color: rgba(255, 255, 255, 0.9);
            margin: 10px 0 16px 0;
            transition: all 0.3s ease;
        }

        .glass-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .glass-input:focus,
        .glass-select:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.4);
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 0 4px rgba(255, 255, 255, 0.1);
        }

        .glass-select option {
            background: rgba(40, 40, 40, 0.95);
            color: rgba(255, 255, 255, 0.9);
        }

        .glass-textarea {
            width: 100%;
            padding: 22px 24px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 24px;
            font-size: 1.05rem;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            color: rgba(255, 255, 255, 0.9);
            margin: 16px 0;
            transition: all 0.3s ease;
            resize: vertical;
            min-height: 120px;
            font-family: inherit;
        }

        .glass-textarea::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .glass-textarea:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.4);
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 0 4px rgba(255, 255, 255, 0.1);
        }

        .glass-btn {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.25);
            padding: 22px 32px;
            border-radius: 24px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            width: 100%;
            position: relative;
            overflow: hidden;
        }

        .glass-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.2), 
                transparent);
            transition: left 0.6s ease;
        }

        .glass-btn:hover::before {
            left: 100%;
        }

        .glass-btn:hover {
            transform: translateY(-4px);
            background: rgba(255, 255, 255, 0.25);
            border-color: rgba(255, 255, 255, 0.4);
            box-shadow: 
                0 16px 32px rgba(0, 0, 0, 0.3),
                0 8px 16px rgba(0, 0, 0, 0.2);
        }

        .glass-btn-secondary {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.3);
            margin-top: 12px;
        }

        .glass-btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .glass-btn-small {
            padding: 16px 24px;
            font-size: 1rem;
            margin-top: 8px;
        }

        .result-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            border-radius: 28px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 40px 32px;
            margin: 32px 0;
            text-align: center;
        }

        .trust-box {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            padding: 28px 24px;
            margin: 24px 0;
            text-align: left;
        }

        .trust-title {
            color: rgba(255, 255, 255, 0.95);
            font-weight: 600;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.1rem;
        }

        .trust-text {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .optional-label {
            color: rgba(255, 255, 255, 0.6);
            font-style: italic;
            font-size: 0.9rem;
            margin-bottom: 8px;
            display: block;
        }

        .pulse-glow {
            animation: pulseGlow 3s infinite;
        }

        @keyframes pulseGlow {
            0% { 
                box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.4);
            }
            70% { 
                box-shadow: 0 0 0 15px rgba(255, 255, 255, 0);
            }
            100% { 
                box-shadow: 0 0 0 0 rgba(255, 255, 255, 0);
            }
        }

        .id-badge {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 20px;
            margin: 24px 0;
            font-family: 'SF Mono', Monaco, monospace;
            font-size: 1.3rem;
            letter-spacing: 2px;
            color: rgba(255, 255, 255, 0.9);
        }

        .comment-preview {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            padding: 20px;
            margin: 16px 0;
            text-align: left;
            border-left: 4px solid rgba(255, 255, 255, 0.3);
        }

        .comment-preview p {
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.5;
            margin-bottom: 8px;
        }

        .comment-preview .label {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .download-section {
            margin-top: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            text-align: center;
        }
        
        .download-btn {
            background: rgba(76, 175, 80, 0.3);
            border: 1px solid rgba(76, 175, 80, 0.5);
            color: white;
            padding: 12px 24px;
            border-radius: 12px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
        }
        
        .download-btn:hover {
            background: rgba(76, 175, 80, 0.5);
            transform: translateY(-2px);
        }
        
        .whatsapp-btn {
            background: rgba(37, 211, 102, 0.3);
            border: 1px solid rgba(37, 211, 102, 0.5);
        }
        
        .whatsapp-btn:hover {
            background: rgba(37, 211, 102, 0.5);
        }
    </style>
</head>
<body>
    <div class="iphone-glass">
        <div class="glass-shine"></div>
        
        <div class="logo">Optimind</div>
        <div class="tagline">Bienestar Estudiantil Inteligente</div>

        <!-- Paso 1: Bienvenida -->
        <div id="step1" class="step active">
            <h1>Tu Bienestar es Primero ‚ú®</h1>
            <p class="subtitle">
                Un espacio seguro para expresar c√≥mo te sientes. 
                Tu voz importa y nos ayuda a crear un mejor entorno para todos.
            </p>

            <div class="trust-box">
                <div class="trust-title">üîí Privacidad Garantizada</div>
                <p class="trust-text">
                    Tus respuestas se almacenan en sistemas seguros del establecimiento. 
                    Solo el equipo de bienestar estudiantil autorizado puede acceder a esta informaci√≥n, 
                    siempre con fines de apoyo y mejora continua.
                </p>
            </div>

            <button class="glass-btn pulse-glow" onclick="nextStep(2)">
                Comenzar Ahora üöÄ
            </button>
            
            <div class="download-section">
                <p style="color: rgba(255,255,255,0.8); margin-bottom: 15px;">
                    ¬øQuieres usar esta aplicaci√≥n offline?
                </p>
                <button class="download-btn" onclick="descargarHTML()">
                    üì• Descargar Aplicaci√≥n
                </button>
            </div>
        </div>

        <!-- Paso 2: Selecci√≥n emocional -->
        <div id="step2" class="step">
            <h1>¬øC√≥mo te sientes hoy?</h1>
            <p class="subtitle">
                Elige el emoji que mejor represente tu estado emocional esta semana
            </p>

            <div class="emoji-grid">
                <div class="glass-card verde" onclick="seleccionarEmocion('verde')">
                    <div class="emoji-icon">üòä</div>
                    <div class="emoji-text">
                        <div class="emoji-title">üü¢ ME SIENTO BIEN</div>
                        <div class="emoji-desc">Contento, con energ√≠a positiva y motivaci√≥n</div>
                    </div>
                </div>

                <div class="glass-card amarillo" onclick="seleccionarEmocion('amarillo')">
                    <div class="emoji-icon">üòê</div>
                    <div class="emoji-text">
                        <div class="emoji-title">üü° TENGO ALTIBAJOS</div>
                        <div class="emoji-desc">Algunos d√≠as son mejores que otros, voy sobrellevando</div>
                    </div>
                </div>

                <div class="glass-card rojo" onclick="seleccionarEmocion('rojo')">
                    <div class="emoji-icon">üòî</div>
                    <div class="emoji-text">
                        <div class="emoji-title">üî¥ NECESITO APOYO</div>
                        <div class="emoji-desc">Estoy pasando por un momento dif√≠cil, necesito hablar</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Paso 3: Curso, colegio y comuna -->
        <div id="step3" class="step">
            <h1>Cu√©ntanos un poco m√°s üéì</h1>
            <p class="subtitle">
                Para entender mejor la realidad de los estudiantes, ind√≠canos tu curso, colegio y comuna de Santiago.
            </p>

            <select class="glass-select" id="cursoSelector">
                <option value="">Selecciona tu curso</option>
                <option value="7¬∞ B√°sico">7¬∞ B√°sico</option>
                <option value="8¬∞ B√°sico">8¬∞ B√°sico</option>
                <option value="1¬∞ Medio">1¬∞ Medio</option>
                <option value="2¬∞ Medio">2¬∞ Medio</option>
                <option value="3¬∞ Medio">3¬∞ Medio</option>
                <option value="4¬∞ Medio">4¬∞ Medio</option>
                <option value="prefiero-no-decir">Prefiero no especificar</option>
            </select>

            <input 
                type="text" 
                class="glass-input" 
                id="colegioInput" 
                placeholder="Nombre del colegio (Ej: Liceo Nacional de Santiago)"
            >

            <input 
                type="text" 
                class="glass-input" 
                id="comunaInput" 
                placeholder="Comuna de Santiago (Ej: √ëu√±oa, Maip√∫, Puente Alto)"
            >

            <button class="glass-btn" onclick="nextStep(4)">
                Continuar üìù
            </button>
            <button class="glass-btn glass-btn-secondary" onclick="saltarCurso()">
                Saltar este paso
            </button>
        </div>

        <!-- Paso 4: Comentarios opcionales -->
        <div id="step4" class="step">
            <h1>¬øAlgo m√°s que compartir? üí≠</h1>
            <p class="subtitle">
                Si quieres, puedes agregar un comentario para ayudarnos a entender mejor tu situaci√≥n
            </p>

            <span class="optional-label">Completamente opcional - Tu privacidad est√° protegida</span>
            <textarea 
                class="glass-textarea" 
                id="comentarioInput"
                placeholder="Ej: Me gustar√≠a hablar sobre...
Me siento as√≠ porque...
Algo que me preocupa es..."
                maxlength="500"
            ></textarea>
            
            <div style="text-align: right; color: rgba(255,255,255,0.6); font-size: 0.9rem; margin-bottom: 20px;">
                <span id="contadorCaracteres">0</span>/500 caracteres
            </div>

            <div class="trust-box">
                <div class="trust-title">üí´ Tu Voz Importa</div>
                <p class="trust-text">
                    Los comentarios nos ayudan a brindarte un apoyo m√°s personalizado y efectivo. 
                    Toda la informaci√≥n se maneja con absoluta confidencialidad y profesionalismo.
                </p>
            </div>

            <button class="glass-btn" onclick="enviarRespuesta()">
                Enviar Mi Respuesta ‚ú®
            </button>
            <button class="glass-btn glass-btn-secondary glass-btn-small" onclick="saltarComentario()">
                Enviar sin comentario
            </button>
        </div>

        <!-- Paso 5: Confirmaci√≥n -->
        <div id="step5" class="step">
            <div class="result-container">
                <div style="font-size: 4.5rem; margin-bottom: 20px; filter: drop-shadow(0 8px 16px rgba(0,0,0,0.3));">üéâ</div>
                <h1 style="color: rgba(255,255,255,0.95); margin-bottom: 16px;">¬°Gracias por Confiar!</h1>
                <p class="subtitle" style="margin-bottom: 28px;">
                    Tu respuesta ha sido registrada de forma segura y confidencial
                </p>
                
                <div class="id-badge">
                    <div style="font-size: 0.9rem; opacity: 0.7; margin-bottom: 8px;">ID DE RESPUESTA</div>
                    <div id="respuestaId" style="font-weight: 600;"></div>
                </div>

                <!-- Vista previa del comentario si existe -->
                <div id="vistaPreviaComentario" class="comment-preview" style="display: none;">
                    <div class="label">TU COMENTARIO:</div>
                    <p id="textoComentario"></p>
                </div>

                <p style="color: rgba(255,255,255,0.8); font-size: 0.95rem; line-height: 1.5; margin-top: 20px;">
                    <strong>Tu contribuci√≥n es valiosa:</strong> Ayudas a construir un sistema 
                    que beneficia a toda la comunidad estudiantil.
                </p>
            </div>

            <button class="glass-btn whatsapp-btn" onclick="enviarTodoPorWhatsApp()">
                Enviar Todo por WhatsApp üí¨
            </button>
            <button class="glass-btn glass-btn-secondary" onclick="nextStep(6)">
                Dar Feedback sobre la App ‚≠ê
            </button>
        </div>

        <!-- Paso 6: Feedback sobre Optimind -->
        <div id="step6" class="step">
            <div class="result-container">
                <div style="font-size: 3.2rem; margin-bottom: 20px; filter: drop-shadow(0 6px 12px rgba(0,0,0,0.3));">üß†</div>
                <h1 style="color: rgba(255,255,255,0.95); margin-bottom: 16px;">Ay√∫danos a Mejorar Optimind</h1>
                <p class="subtitle" style="margin-bottom: 32px;">
                    Tu opini√≥n es clave para construir una app segura, √∫til y realmente necesaria para estudiantes como t√∫.
                </p>

                <!-- Pregunta 1: usar√≠a la app -->
                <div class="trust-box">
                    <div class="trust-title">üì± ¬øUsar√≠as una app como Optimind?</div>
                    <div class="trust-text">
                        <label><input type="radio" name="fb_usaria" value="si"> S√≠, la usar√≠a</label><br>
                        <label><input type="radio" name="fb_usaria" value="tal_vez"> Tal vez</label><br>
                        <label><input type="radio" name="fb_usaria" value="no"> No la usar√≠a</label>
                    </div>
                </div>

                <!-- Pregunta 2: comodidad con anonimato -->
                <div class="trust-box">
                    <div class="trust-title">üîí ¬øTe sientes c√≥modo/a compartiendo tu estado de √°nimo de forma an√≥nima?</div>
                    <select id="fb_anonimato" class="glass-select">
                        <option value="">Selecciona una opci√≥n</option>
                        <option value="1">1 - Nada c√≥modo/a</option>
                        <option value="2">2 - Poco c√≥modo/a</option>
                        <option value="3">3 - Neutral</option>
                        <option value="4">4 - C√≥modo/a</option>
                        <option value="5">5 - Muy c√≥modo/a</option>
                    </select>
                </div>

                <!-- Pregunta 3: opini√≥n abierta -->
                <div class="trust-box">
                    <div class="trust-title">üí¨ ¬øQu√© te parece la idea de Optimind?</div>
                    <textarea 
                        id="fb_opinion" 
                        class="glass-textarea" 
                        placeholder="Escribe aqu√≠ tu opini√≥n, ideas o mejoras..."
                        maxlength="300"
                    ></textarea>
                    <div style="color: rgba(255,255,255,0.6); font-size: 0.8rem; text-align:right;">
                        <span id="fb_contador">0</span>/300
                    </div>
                </div>

                <button class="glass-btn whatsapp-btn" onclick="enviarTodoPorWhatsApp()">
                    Enviar Todo por WhatsApp üì±
                </button>

                <button class="glass-btn glass-btn-secondary" onclick="reiniciarSistema()">
                    Terminar sin Enviar üîÑ
                </button>
            </div>
        </div>
    </div>

    <script>
        let emocionSeleccionada = '';
        let idUnico = '';
        let cursoSeleccionado = '';
        let datosRespuesta = {};

        function generarIdUnico() {
            const letras = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            const numeros = '0123456789';
            let codigo = '';
            for (let i = 0; i < 3; i++) {
                codigo += letras[Math.floor(Math.random() * letras.length)];
            }
            for (let i = 0; i < 2; i++) {
                codigo += numeros[Math.floor(Math.random() * numeros.length)];
            }
            return codigo;
        }

        function seleccionarEmocion(emocion) {
            emocionSeleccionada = emocion;
            nextStep(3);
        }

        function saltarCurso() {
            cursoSeleccionado = 'no-especificado';
            nextStep(4);
        }

        function saltarComentario() {
            enviarDatos('');
        }

        function enviarRespuesta() {
            const comentario = document.getElementById('comentarioInput').value.trim();
            enviarDatos(comentario);
        }

        function enviarDatos(comentario) {
            idUnico = generarIdUnico();
            
            const curso = document.getElementById('cursoSelector').value || 'no-especificado';
            const colegio = document.getElementById('colegioInput').value.trim() || 'no-especificado';
            const comuna = document.getElementById('comunaInput').value.trim() || 'no-especificada';

            document.getElementById('respuestaId').textContent = idUnico;
            
            const vistaPrevia = document.getElementById('vistaPreviaComentario');
            const textoComentario = document.getElementById('textoComentario');
            
            if (comentario) {
                textoComentario.textContent = comentario;
                vistaPrevia.style.display = 'block';
            } else {
                vistaPrevia.style.display = 'none';
            }
            
            datosRespuesta = {
                id: idUnico,
                emocion: emocionSeleccionada,
                curso: curso,
                colegio: colegio,
                comuna: comuna,
                comentario: comentario || '',
                timestamp: new Date().toISOString()
            };

            console.log('üì§ Datos listos para enviar:', datosRespuesta);
            
            nextStep(5);
        }

        function obtenerTextoEmocion(emocion) {
            switch(emocion) {
                case 'verde':
                    return 'üü¢ ME SIENTO BIEN';
                case 'amarillo':
                    return 'üü° TENGO ALTIBAJOS';
                case 'rojo':
                    return 'üî¥ NECESITO APOYO';
                default:
                    return 'No especificado';
            }
        }

        function obtenerTextoComodidad(valor) {
            switch(valor) {
                case '1': return '1 - Nada c√≥modo/a';
                case '2': return '2 - Poco c√≥modo/a';
                case '3': return '3 - Neutral';
                case '4': return '4 - C√≥modo/a';
                case '5': return '5 - Muy c√≥modo/a';
                default: return 'No especificado';
            }
        }

        function obtenerTextoUsoApp(valor) {
            switch(valor) {
                case 'si': return 'S√≠, la usar√≠a';
                case 'tal_vez': return 'Tal vez';
                case 'no': return 'No la usar√≠a';
                default: return 'No especificado';
            }
        }

        function obtenerDatosFeedback() {
            const fb_usaria = document.querySelector('input[name="fb_usaria"]:checked');
            const fb_anonimato = document.getElementById('fb_anonimato').value;
            const fb_opinion = document.getElementById('fb_opinion').value.trim();

            if (!fb_usaria || fb_anonimato === "") {
                alert("Por favor responde las dos primeras preguntas antes de continuar.");
                return null;
            }

            return {
                usar_app: fb_usaria.value,
                comodidad_anonimato: fb_anonimato,
                opinion: fb_opinion,
                timestamp: new Date().toISOString()
            };
        }

        function enviarTodoPorWhatsApp() {
            // Obtener datos del feedback si estamos en el paso 6
            let datosFeedback = {};
            if (document.getElementById('step6').classList.contains('active')) {
                datosFeedback = obtenerDatosFeedback();
                if (!datosFeedback) return;
            }

            // Crear mensaje completo para WhatsApp
            let mensaje = `*RESPUESTA COMPLETA - Optimind*\n\n`;
            mensaje += `*ID:* ${datosRespuesta.id || 'N/A'}\n`;
            mensaje += `*Estado Emocional:* ${obtenerTextoEmocion(datosRespuesta.emocion)}\n`;
            mensaje += `*Curso:* ${datosRespuesta.curso}\n`;
            mensaje += `*Colegio:* ${datosRespuesta.colegio}\n`;
            mensaje += `*Comuna:* ${datosRespuesta.comuna}\n`;
            
            if (datosRespuesta.comentario) {
                mensaje += `*Comentario Personal:*\n${datosRespuesta.comentario}\n`;
            }

            // Si hay datos de feedback, agregarlos
            if (datosFeedback.usar_app) {
                mensaje += `\n*--- FEEDBACK SOBRE LA APP ---*\n`;
                mensaje += `*¬øUsar√≠a la app?:* ${obtenerTextoUsoApp(datosFeedback.usar_app)}\n`;
                mensaje += `*Comodidad con anonimato:* ${obtenerTextoComodidad(datosFeedback.comodidad_anonimato)}\n`;
                
                if (datosFeedback.opinion) {
                    mensaje += `*Opini√≥n/Mejoras:*\n${datosFeedback.opinion}\n`;
                }
            }
            
            mensaje += `\n*Fecha:* ${new Date().toLocaleString('es-CL')}\n`;
            mensaje += `_Enviado desde Optimind_`;

            const mensajeCodificado = encodeURIComponent(mensaje);
            const numeroWhatsApp = '+56993913029';
            const urlWhatsApp = `https://wa.me/${numeroWhatsApp}?text=${mensajeCodificado}`;
            
            // Abrir WhatsApp
            window.open(urlWhatsApp, '_blank');
            
            console.log("üì§ Datos enviados por WhatsApp:", { datosRespuesta, datosFeedback });
            
            // Mostrar confirmaci√≥n y reiniciar
            setTimeout(() => {
                alert("¬°Gracias por tu contribuci√≥n! Todo se ha enviado correctamente üíú");
                reiniciarSistema();
            }, 1000);
        }

        function nextStep(paso) {
            document.querySelectorAll('.step').forEach(step => {
                step.classList.remove('active');
            });
            document.getElementById(`step${paso}`).classList.add('active');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function reiniciarSistema() {
            emocionSeleccionada = '';
            idUnico = '';
            cursoSeleccionado = '';
            datosRespuesta = {};

            const cursoSelector = document.getElementById('cursoSelector');
            if (cursoSelector) cursoSelector.value = '';

            const colegioInput = document.getElementById('colegioInput');
            if (colegioInput) colegioInput.value = '';

            const comunaInput = document.getElementById('comunaInput');
            if (comunaInput) comunaInput.value = '';

            const comentarioInput = document.getElementById('comentarioInput');
            if (comentarioInput) comentarioInput.value = '';

            const contadorCaracteres = document.getElementById('contadorCaracteres');
            if (contadorCaracteres) contadorCaracteres.textContent = '0';

            const fbOpinion = document.getElementById('fb_opinion');
            if (fbOpinion) fbOpinion.value = '';

            const fbContador = document.getElementById('fb_contador');
            if (fbContador) fbContador.textContent = '0';

            const fbAnonimato = document.getElementById('fb_anonimato');
            if (fbAnonimato) fbAnonimato.value = '';

            const fbRadios = document.querySelectorAll('input[name="fb_usaria"]');
            fbRadios.forEach(r => r.checked = false);

            nextStep(1);
        }

        // Contador de caracteres para el comentario principal
        document.getElementById('comentarioInput').addEventListener('input', function() {
            const contador = document.getElementById('contadorCaracteres');
            contador.textContent = this.value.length;
            
            if (this.value.length > 400) {
                contador.style.color = 'rgba(239, 68, 68, 0.9)';
            } else if (this.value.length > 300) {
                contador.style.color = 'rgba(245, 158, 11, 0.9)';
            } else {
                contador.style.color = 'rgba(255, 255, 255, 0.6)';
            }
        });

        // Contador de caracteres para feedback de la app
        document.getElementById('fb_opinion').addEventListener('input', function() {
            const contador = document.getElementById('fb_contador');
            contador.textContent = this.value.length;
        });

        // Efectos de interactividad mejorados
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üéØ Sistema Optimind - Con Comentarios, Segmentaci√≥n y Feedback Activado');
            
            const cards = document.querySelectorAll('.glass-card');
            cards.forEach(card => {
                card.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-8px) scale(1.02)';
                });
                card.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0) scale(1)';
                });
            });

            const buttons = document.querySelectorAll('.glass-btn');
            buttons.forEach(btn => {
                btn.addEventListener('click', function(e) {
                    const ripple = document.createElement('span');
                    const rect = this.getBoundingClientRect();
                    const size = Math.max(rect.width, rect.height);
                    const x = e.clientX - rect.left - size / 2;
                    const y = e.clientY - rect.top - size / 2;
                    
                    ripple.style.cssText = `
                        position: absolute;
                        border-radius: 50%;
                        background: rgba(255, 255, 255, 0.6);
                        transform: scale(0);
                        animation: ripple 0.6s linear;
                        width: ${size}px;
                        height: ${size}px;
                        left: ${x}px;
                        top: ${y}px;
                    `;
                    
                    this.appendChild(ripple);
                    
                    setTimeout(() => {
                        ripple.remove();
                    }, 600);
                });
            });
        });

        // Funci√≥n para descargar el archivo HTML
        function descargarHTML() {
            // Crear el contenido completo del archivo HTML
            const contenidoHTML = `<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Optimind - Bienestar Estudiantil</title>
    <style>
        ${document.querySelector('style').innerHTML}
    </style>
</head>
<body>
    ${document.querySelector('.iphone-glass').outerHTML}
    <script>
        ${document.querySelector('script').innerHTML}
    <\/script>
</body>
</html>`;

            // Crear un blob con el contenido
            const blob = new Blob([contenidoHTML], { type: 'text/html' });
            
            // Crear un enlace de descarga
            const enlace = document.createElement('a');
            enlace.href = URL.createObjectURL(blob);
            enlace.download = 'optimind-bienestar-estudiantil.html';
            
            // Simular clic en el enlace
            document.body.appendChild(enlace);
            enlace.click();
            document.body.removeChild(enlace);
            
            // Mostrar mensaje de confirmaci√≥n
            alert('‚úÖ Archivo descargado correctamente.\n\nGuarda el archivo "optimind-bienestar-estudiantil.html" y √°brelo en cualquier navegador para usar la aplicaci√≥n.');
        }

        const style = document.createElement('style');
        style.textContent = `
            @keyframes ripple {
                to {
                    transform: scale(4);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>